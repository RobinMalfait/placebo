import { expect, it } from 'vitest'
import { toHtml } from '.'
import type { Diagnostic } from '../../types'
import { findLocations } from '../../utils/find-location'

const html = String.raw

it('should convert ANSI to HTML', () => {
  let source = html`
    <div>
      <div class="block"></div>
      <div class="flex">
        <div class="block"></div>
      </div>
    </div>
  `

  let diagnostics: Diagnostic[] = findLocations(source, {
    regex: /block/g,
  }).map((location) => ({
    file: 'example.html',
    source,
    message: 'This is a block class',
    location,
    blockId: 'block-class-issue',
    relatedId: 'block',
    notes: [
      '- Some `additional` info',
      '- More _info_ **about** the `issue`',
      '- With a [Link](https://example.com)',
    ].join('\n'),
  }))

  expect(
    toHtml(diagnostics, {
      rendering: {
        printWidth: 100,
      },
    }),
  ).toMatchInlineSnapshot(`
    "<pre>    <span class="text-current/50">â”Œ</span><span class="text-current/50">â”€</span><span class="text-current/50">[</span><span class="font-bold">.&#x2F;example.html</span><span class="text-current/50">]</span>
    <span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50">â”‚</span>
      <span class="text-current/50">2</span> <span class="text-current/50">â”‚</span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50">&lt;</span><span class="text-current/50">d</span><span class="text-current/50">i</span><span class="text-current/50">v</span><span class="text-current/50">&gt;</span>
    <span class="text-placebo-red">âˆ™</span> 3 <span class="text-current/50">â”‚</span>      &lt;div class=&#34;block&#34;&gt;&lt;/div&gt;
        <span class="text-current/50">Â·</span>                  <span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”¬</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span>
        <span class="text-current/50">Â·</span> <span class="text-placebo-yellow">â•­</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â•¯</span>
        <span class="text-current/50">Â·</span> <span class="text-placebo-yellow">â”‚</span>
      <span class="text-current/50">4</span> <span class="text-current/50">â”‚</span><span class="text-current/50"> </span><span class="text-placebo-yellow">â”‚</span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50">&lt;</span><span class="text-current/50">d</span><span class="text-current/50">i</span><span class="text-current/50">v</span><span class="text-current/50"> </span><span class="text-current/50">c</span><span class="text-current/50">l</span><span class="text-current/50">a</span><span class="text-current/50">s</span><span class="text-current/50">s</span><span class="text-current/50">=</span><span class="text-current/50">&#34;</span><span class="text-current/50">f</span><span class="text-current/50">l</span><span class="text-current/50">e</span><span class="text-current/50">x</span><span class="text-current/50">&#34;</span><span class="text-current/50">&gt;</span>
    <span class="text-placebo-red">âˆ™</span> 5 <span class="text-current/50">â”‚</span> <span class="text-placebo-yellow">â”‚</span>      &lt;div class=&#34;block&#34;&gt;&lt;/div&gt;
        <span class="text-current/50">Â·</span> <span class="text-placebo-yellow">â”‚</span>                  <span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”¬</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span>
        <span class="text-current/50">Â·</span> <span class="text-placebo-yellow">â•°</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”´</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span><span class="text-placebo-yellow">â”€</span> <span class="text-placebo-yellow">T</span><span class="text-placebo-yellow">h</span><span class="text-placebo-yellow">i</span><span class="text-placebo-yellow">s</span><span class="text-placebo-yellow"> </span><span class="text-placebo-yellow">i</span><span class="text-placebo-yellow">s</span><span class="text-placebo-yellow"> </span><span class="text-placebo-yellow">a</span><span class="text-placebo-yellow"> </span><span class="text-placebo-yellow">b</span><span class="text-placebo-yellow">l</span><span class="text-placebo-yellow">o</span><span class="text-placebo-yellow">c</span><span class="text-placebo-yellow">k</span><span class="text-placebo-yellow"> </span><span class="text-placebo-yellow">c</span><span class="text-placebo-yellow">l</span><span class="text-placebo-yellow">a</span><span class="text-placebo-yellow">s</span><span class="text-placebo-yellow">s</span>
        <span class="text-current/50">Â·</span>
      <span class="text-current/50">6</span> <span class="text-current/50">â”‚</span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50">&lt;</span><span class="text-current/50">/</span><span class="text-current/50">d</span><span class="text-current/50">i</span><span class="text-current/50">v</span><span class="text-current/50">&gt;</span>
      <span class="text-current/50">7</span> <span class="text-current/50">â”‚</span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50">&lt;</span><span class="text-current/50">/</span><span class="text-current/50">d</span><span class="text-current/50">i</span><span class="text-current/50">v</span><span class="text-current/50">&gt;</span>
        <span class="text-current/50">Â·</span>
        <span class="text-current/50">â”œ</span><span class="text-current/50">â”€</span>
        <span class="text-current/50">Â·</span>   <span class="text-current/50">-</span><span class="text-current/50"></span> </span><span class="text-current/50"></span>S</span><span class="text-current/50"></span>o</span><span class="text-current/50"></span>m</span><span class="text-current/50"></span>e</span><span class="text-current/50"></span> </span><span class="text-current/50"></span><span class="text-placebo-blue">\`</span></span><span class="text-current/50"></span><span class="text-placebo-blue">a</span></span><span class="text-current/50"></span><span class="text-placebo-blue">d</span></span><span class="text-current/50"></span><span class="text-placebo-blue">d</span></span><span class="text-current/50"></span><span class="text-placebo-blue">i</span></span><span class="text-current/50"></span><span class="text-placebo-blue">t</span></span><span class="text-current/50"></span><span class="text-placebo-blue">i</span></span><span class="text-current/50"></span><span class="text-placebo-blue">o</span></span><span class="text-current/50"></span><span class="text-placebo-blue">n</span></span><span class="text-current/50"></span><span class="text-placebo-blue">a</span></span><span class="text-current/50"></span><span class="text-placebo-blue">l</span></span><span class="text-current/50"></span><span class="text-placebo-blue">\`</span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span> </span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span>i</span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span>n</span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span>f</span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span>o</span></span>
        <span class="text-current/50">Â·</span>   <span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50">-</span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span> </span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>M</span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>o</span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>r</span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>e</span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span> </span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic">i</span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic">n</span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic">f</span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic">o</span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span> </span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold">a</span></span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold">b</span></span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold">o</span></span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold">u</span></span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold">t</span></span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span> </span></span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span>t</span></span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span>h</span></span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span>e</span></span></span></span></span><span class="text-current/50"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span> </span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue">\`</span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue">i</span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue">s</span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue">s</span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue">u</span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue">e</span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue">\`</span></span></span></span></span>
        <span class="text-current/50">Â·</span>   <span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50">-</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span> </span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>W</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>i</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>t</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>h</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span> </span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>a</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span></span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>]</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>8</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>;</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>;</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>h</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>t</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>t</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>p</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>s</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>:</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>/</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>/</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>e</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>x</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>a</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>m</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>p</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>l</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>e</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>.</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>c</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>o</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>m</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span></span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>\\</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>L</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>i</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>n</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>k</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span></span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>]</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>8</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>;</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>;</span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span></span></span></span></span></span></span><span class="text-current/50"></span></span><span class="text-current/50"></span><span class="italic"></span><span class="font-bold"></span><span class="text-placebo-blue"></span><span class="text-current/50"></span>\\</span></span></span></span></span></span>
    <span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50"> </span><span class="text-current/50">â””</span><span class="text-current/50">â”€</span></pre>"
  `)
})
